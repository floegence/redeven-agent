version: v1
tasks:
  - id: project_brief
    title: Project brief analysis
    stage: screen
    category: failure_real
    turns:
      - "Quickly analyze project ${workspace} using real files, and report the tech stack, directory layout, and run instructions. You must cite at least 2 absolute evidence file paths."
    max_steps: 4
    timeout_seconds: 35
    require_evidence: true
    must_contain:
      - "tech stack|stack"
      - "structure|module"
      - "run|start"
    forbidden:
      - "Tool workflow failed"
      - "Assistant finished without a visible response"
      - "No response"
    hard_fail_events:
      - "turn.loop.exhausted"
      - "turn.completion.continue"
      - "task.loop.continue"
    must_not_end_with_fallback: true

  - id: root_stat
    title: Root stat synthesis
    stage: screen
    category: generic
    turns:
      - "Call fs.stat for /. Then output whether it is directory."
    max_steps: 3
    timeout_seconds: 20
    require_evidence: false
    must_contain:
      - "directory"
    forbidden:
      - "Tool workflow failed"
      - "No response"
    hard_fail_events:
      - "turn.loop.exhausted"
    must_not_end_with_fallback: true

  - id: approval_fallback
    title: Approval denied fallback
    stage: screen
    category: failure_real
    turns:
      - "First try terminal.exec with pwd (cwd=${workspace}). If approval fails or is denied, immediately switch to fs.list_dir/fs.read_file and still provide a usable conclusion. Do not stop at the failure."
    max_steps: 5
    timeout_seconds: 35
    require_evidence: true
    must_contain:
      - "conclusion|result"
    forbidden:
      - "Tool workflow failed"
      - "No response"
    hard_fail_events:
      - "turn.loop.exhausted"
      - "task.loop.continue"
    must_not_end_with_fallback: true

  - id: project_deep
    title: Project deep analysis
    stage: deep
    category: generic
    turns:
      - "Deeply analyze project ${workspace}: tech stack, module boundaries, run instructions, risk list, and next-step suggestions. You must cite at least 3 absolute evidence file paths."
    max_steps: 6
    timeout_seconds: 45
    require_evidence: true
    must_contain:
      - "tech stack|stack"
      - "risk"
      - "next steps|recommend"
    forbidden:
      - "Tool workflow failed"
      - "No response"
    hard_fail_events:
      - "turn.loop.exhausted"
      - "task.loop.continue"
    must_not_end_with_fallback: true

  - id: continue_context
    title: Continue context follow-up
    stage: deep
    category: failure_real
    turns:
      - "Analyze ${workspace} using real files and provide an initial conclusion (at least 2 evidence paths), then explicitly state that deeper analysis can continue."
      - "continue"
    max_steps: 5
    timeout_seconds: 40
    require_evidence: true
    must_contain:
      - "continue"
      - "summary|findings|conclusion"
    forbidden:
      - "Tool workflow failed"
      - "No response"
    hard_fail_events:
      - "turn.loop.exhausted"
      - "task.loop.continue"
    must_not_end_with_fallback: true
